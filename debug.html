<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug PWA - Wonderland</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 20px auto; 
            padding: 20px;
            background: #f0f0f0;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            background: white;
        }
        .success { border-left: 4px solid green; }
        .error { border-left: 4px solid red; }
        .warning { border-left: 4px solid orange; }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            background: #667eea; 
            color: white; 
            cursor: pointer;
        }
        button:hover { background: #5a67d8; }
    </style>
</head>
<body>
    <h1>ğŸ”§ PWA Debug - Wonderland</h1>
    
    <div id="status"></div>
    
    <h2>Acciones de depuraciÃ³n:</h2>
    <button onclick="clearAllCaches()">ğŸ—‘ï¸ Limpiar Caches</button>
    <button onclick="unregisterSW()">âŒ Desregistrar SW</button>
    <button onclick="reloadAndTest()">ğŸ”„ Recargar y Probar</button>
    <button onclick="window.location.href='index.html'">ğŸ  Ir a App</button>
    
    <script>
        function updateStatus() {
            const statusDiv = document.getElementById('status');
            let html = '';
            
            // Check Service Worker
            if ('serviceWorker' in navigator) {
                html += `<div class="status success">âœ… Service Worker soportado</div>`;
                
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        html += `<div class="status success">âœ… SW Registrado: ${registrations.length}</div>`;
                    } else {
                        html += `<div class="status error">âŒ SW No registrado</div>`;
                    }
                    statusDiv.innerHTML = html;
                });
            } else {
                html += `<div class="status error">âŒ Service Worker no soportado</div>`;
            }
            
            // Check PWA install
            if (window.matchMedia('(display-mode: standalone)').matches) {
                html += `<div class="status success">âœ… PWA instalada (modo standalone)</div>`;
            } else {
                html += `<div class="status warning">âš ï¸ EjecutÃ¡ndose en navegador</div>`;
            }
            
            // Check current URL
            html += `<div class="status">ğŸ“ URL actual: ${window.location.href}</div>`;
            html += `<div class="status">ğŸ“ Origin: ${window.location.origin}</div>`;
            html += `<div class="status">ğŸ“ Pathname: ${window.location.pathname}</div>`;
            
            statusDiv.innerHTML = html;
        }
        
        async function clearAllCaches() {
            try {
                const cacheNames = await caches.keys();
                await Promise.all(
                    cacheNames.map(name => caches.delete(name))
                );
                alert(`âœ… Caches eliminados: ${cacheNames.join(', ')}`);
                updateStatus();
            } catch (error) {
                alert(`âŒ Error: ${error.message}`);
            }
        }
        
        async function unregisterSW() {
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                await Promise.all(
                    registrations.map(reg => reg.unregister())
                );
                alert(`âœ… Service Workers desregistrados: ${registrations.length}`);
                updateStatus();
            } catch (error) {
                alert(`âŒ Error: ${error.message}`);
            }
        }
        
        function reloadAndTest() {
            window.location.reload();
        }
        
        // Auto-update status
        updateStatus();
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>